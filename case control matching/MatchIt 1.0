library(tidyverse)
library(MatchIt)
library(cobalt)

# Combine dataframes
combined_df <- bind_rows(
  ADHD_demographics %>%         # cases
    mutate(ADHD = 1),
  NO_ADHD_demographics %>%      # controls
    mutate(ADHD = 0)
)

# Match
matched <- matchit(
  ADHD ~ sex_at_birth + birth_year + self_reported_category,
  data = combined_df,
  method = "nearest",
  exact = ~sex_at_birth,
  ratio = 4,                       # 4 controls per case
  replace = FALSE
)

# Diagnostics
plot(matched, type = "density")

# Extract matched data
matched_df <- match.data(matched)

# Split into separate dfs
ADHD_matched <- matched_df %>%
  filter(ADHD == 1)

NO_ADHD_matched <- matched_df %>%
  filter(ADHD == 0) 
